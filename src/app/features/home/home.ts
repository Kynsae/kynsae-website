import { 
  AfterViewInit, 
  ChangeDetectionStrategy, 
  Component, 
  ElementRef, 
  HostListener, 
  inject, 
  viewChild, 
  OnInit 
} from '@angular/core';

import { HomeUIManager } from './services/home-ui-manager';
import { StarRain } from './components/star-rain/star-rain';
import { SvgAnimator } from './components/svg-animator/svg-animator';
import { ProjectsGrid } from '../../shared/components/projects-grid/projects-grid';
import { ProjectsManager } from '../../core/services/projects-manager';
import { TextReveal } from './components/text-reveal/text-reveal';
import { AsciiGrid } from './components/ascii-grid/ascii-grid';
import { StarExposure } from './components/star-exposure/star-exposure';
import { Footer } from '../../shared/components/footer/footer';
import { NavigationLoaderManager } from '../../core/services/navigation-loader-manager';
import { TextHoverSlide } from '../../shared/components/text-hover-slide/text-hover-slide';
import { Router } from "@angular/router";
import { SEOManager } from '../../core/services/seo-manager';
import { Galaxy } from '../../shared/components/galaxy/galaxy';
import { CommonModule } from '@angular/common';
import { NeonSphere } from './components/neon-sphere/neon-sphere';
import { CircularGrid } from './components/circular-grid/circular-grid';

@Component({
  selector: 'app-home',
  imports: [
    StarRain,
    SvgAnimator,
    ProjectsGrid,
    TextReveal,
    AsciiGrid,
    StarExposure,
    Footer,
    TextHoverSlide,
    Galaxy,
    CommonModule,
    NeonSphere,
    CircularGrid
  ],
  templateUrl: './home.html',
  styleUrl: './home.scss',
  providers: [
    HomeUIManager
  ],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class Home implements OnInit, AfterViewInit {
  readonly starSection = viewChild.required<ElementRef<HTMLElement>>('starSection');

  public readonly uiManager = inject(HomeUIManager);
  public readonly projectsManager = inject(ProjectsManager);
  public readonly navigationLoader = inject(NavigationLoaderManager);  
  private readonly seoManager = inject(SEOManager);
  private readonly router = inject(Router);

  public readonly asciiGridTexts: string[] = ['', '', 'WEB', '3D', 'DESIGN', 'APPS', '', ''];

  public readonly animatedSVG = {
    start: 'M 0.899 71.337 L 0.899 2.116 L 65.245 2.116 L 65.245 16.545 L 20.398 16.545 L 20.398 29.415 L 60.858 29.415 L 60.858 43.259 L 20.398 43.259 L 20.398 56.908 L 65.927 56.908 L 65.927 71.337 L 0.899 71.337 Z M 68.628 71.337 L 100.801 35.947 L 69.7 2.116 L 93.879 2.116 L 113.865 24.735 L 133.754 2.116 L 157.055 2.116 L 126.149 35.947 L 158.615 71.337 L 134.534 71.337 L 113.28 47.354 L 91.929 71.337 L 68.628 71.337 Z M 163.135 71.337 L 163.135 2.116 L 203.888 2.116 C 213.182 2.116 220.364 4.132 225.434 8.161 C 230.569 12.126 233.136 18.073 233.136 26.002 C 233.136 33.672 230.569 39.489 225.434 43.454 C 220.364 47.419 213.182 49.401 203.888 49.401 L 182.634 49.401 L 182.634 71.337 L 163.135 71.337 Z M 202.913 16.545 L 182.634 16.545 L 182.634 35.459 L 202.913 35.459 C 206.747 35.459 209.542 34.745 211.297 33.314 C 213.052 31.82 213.93 29.675 213.93 26.88 L 213.93 25.71 C 213.93 22.59 213.052 20.282 211.297 18.788 C 209.542 17.293 206.747 16.545 202.913 16.545 Z M 240.54 71.337 L 240.54 2.116 L 304.887 2.116 L 304.887 16.545 L 260.038 16.545 L 260.038 29.415 L 300.5 29.415 L 300.5 43.259 L 260.038 43.259 L 260.038 56.908 L 305.569 56.908 L 305.569 71.337 L 240.54 71.337 Z M 314.899 71.337 L 314.899 2.116 L 357.602 2.116 C 366.83 2.116 373.752 4.098 378.368 8.063 C 383.048 11.963 385.387 17.65 385.387 25.125 C 385.387 30.519 384.087 35.004 381.488 38.579 C 378.953 42.154 375.248 44.819 370.373 46.574 L 386.07 71.337 L 363.841 71.337 L 350.387 49.109 L 334.398 49.109 L 334.398 71.337 L 314.899 71.337 Z M 355.847 16.545 L 334.398 16.545 L 334.398 35.167 L 355.847 35.167 C 362.54 35.167 365.889 32.21 365.889 26.295 L 365.889 25.32 C 365.889 19.47 362.54 16.545 355.847 16.545 Z M 394.208 71.337 L 394.208 2.116 L 413.707 2.116 L 413.707 71.337 L 394.208 71.337 Z M 425.056 71.337 L 425.056 2.116 L 489.402 2.116 L 489.402 16.545 L 444.554 16.545 L 444.554 29.415 L 485.015 29.415 L 485.015 43.259 L 444.554 43.259 L 444.554 56.908 L 490.084 56.908 L 490.084 71.337 L 425.056 71.337 Z M 499.414 71.337 L 499.414 2.116 L 519.4 2.116 L 552.548 40.919 L 552.646 40.919 L 552.646 2.116 L 570.78 2.116 L 570.78 71.337 L 555.863 71.337 L 517.645 26.685 L 517.548 26.685 L 517.548 71.337 L 499.414 71.337 Z M 622.321 72.605 C 614.001 72.605 606.591 71.142 600.092 68.217 C 593.658 65.227 588.588 61.068 584.883 55.738 C 581.243 50.344 579.423 44.007 579.423 36.727 C 579.423 29.447 581.243 23.143 584.883 17.813 C 588.588 12.483 593.658 8.356 600.092 5.431 C 606.591 2.506 614.001 1.044 622.321 1.044 C 629.6 1.044 636.002 2.084 641.527 4.164 C 647.051 6.243 651.601 9.104 655.176 12.743 C 658.75 16.318 661.156 20.348 662.391 24.832 L 644.939 29.025 C 643.575 25.645 641.754 23.012 639.48 21.128 C 637.204 19.178 634.605 17.813 631.68 17.033 C 628.82 16.253 625.797 15.863 622.613 15.863 C 618.324 15.863 614.391 16.611 610.817 18.105 C 607.241 19.536 604.382 21.713 602.237 24.637 C 600.156 27.562 599.117 31.267 599.117 35.752 L 599.117 37.702 C 599.117 42.121 600.156 45.826 602.237 48.816 C 604.382 51.741 607.241 53.951 610.817 55.446 C 614.391 56.876 618.324 57.591 622.613 57.591 C 625.797 57.591 628.82 57.201 631.68 56.421 C 634.605 55.641 637.204 54.308 639.48 52.423 C 641.754 50.473 643.575 47.809 644.939 44.429 L 662.391 48.621 C 661.156 53.106 658.75 57.168 655.176 60.808 C 651.601 64.383 647.051 67.242 641.527 69.387 C 636.002 71.532 629.6 72.605 622.321 72.605 Z M 670.029 71.337 L 670.029 2.116 L 734.375 2.116 L 734.375 16.545 L 689.528 16.545 L 689.528 29.415 L 729.988 29.415 L 729.988 43.259 L 689.528 43.259 L 689.528 56.908 L 735.057 56.908 L 735.057 71.337 L 670.029 71.337 Z M 779.485 72.507 C 773.44 72.507 767.818 71.922 762.619 70.752 C 757.419 69.517 752.901 67.503 749.067 64.708 C 745.232 61.848 742.274 58.013 740.195 53.203 L 757.646 48.036 C 758.946 50.376 760.474 52.294 762.229 53.788 C 764.049 55.219 766.421 56.291 769.346 57.006 C 772.27 57.656 776.041 57.981 780.655 57.981 C 786.31 57.981 790.599 57.363 793.524 56.128 C 796.449 54.893 797.911 53.301 797.911 51.351 C 797.911 49.856 797.197 48.589 795.767 47.549 C 794.336 46.508 791.606 45.762 787.577 45.306 L 768.761 42.966 C 760.052 41.862 753.552 39.717 749.262 36.532 C 744.972 33.347 742.827 28.927 742.827 23.273 C 742.827 18.268 744.322 14.14 747.312 10.891 C 750.302 7.576 754.527 5.107 759.986 3.481 C 765.511 1.792 771.946 0.946 779.29 0.946 C 784.62 0.946 789.69 1.499 794.499 2.604 C 799.374 3.708 803.696 5.594 807.466 8.258 C 811.3 10.923 814.323 14.661 816.533 19.47 L 799.861 24.637 C 797.911 20.998 795.15 18.561 791.574 17.325 C 788.065 16.09 783.45 15.473 777.73 15.473 C 772.921 15.473 769.053 15.993 766.128 17.033 C 763.269 18.008 761.839 19.438 761.839 21.323 C 761.839 22.948 762.619 24.248 764.178 25.222 C 765.804 26.197 768.436 26.912 772.075 27.367 L 792.744 29.902 C 801.194 30.943 807.368 33.119 811.268 36.434 C 815.168 39.749 817.118 44.136 817.118 49.596 C 817.118 54.666 815.558 58.923 812.438 62.368 C 809.318 65.748 804.931 68.283 799.276 69.972 C 793.622 71.662 787.024 72.507 779.485 72.507 Z',
    end: 'M 0.756 65.562 L 0.756 7.342 L 54.876 7.342 L 54.876 19.478 L 17.156 19.478 L 17.156 30.302 L 51.186 30.302 L 51.186 41.946 L 17.156 41.946 L 17.156 53.426 L 55.45 53.426 L 55.45 65.562 L 0.756 65.562 Z M 57.721 65.562 L 84.781 35.796 L 58.623 7.342 L 78.959 7.342 L 95.769 26.366 L 112.497 7.342 L 132.095 7.342 L 106.101 35.796 L 133.407 65.562 L 113.153 65.562 L 95.277 45.39 L 77.319 65.562 L 57.721 65.562 Z M 137.209 65.562 L 137.209 7.342 L 171.485 7.342 C 179.302 7.342 185.343 9.037 189.607 12.426 C 193.926 15.761 196.085 20.763 196.085 27.432 C 196.085 33.883 193.926 38.775 189.607 42.11 C 185.343 45.445 179.302 47.112 171.485 47.112 L 153.609 47.112 L 153.609 65.562 L 137.209 65.562 Z M 170.665 19.478 L 153.609 19.478 L 153.609 35.386 L 170.665 35.386 C 173.89 35.386 176.241 34.785 177.717 33.582 C 179.193 32.325 179.931 30.521 179.931 28.17 L 179.931 27.186 C 179.931 24.562 179.193 22.621 177.717 21.364 C 176.241 20.107 173.89 19.478 170.665 19.478 Z M 202.312 65.562 L 202.312 7.342 L 386.432 7.342 L 386.432 19.478 L 218.712 19.478 L 218.712 30.302 L 382.742 30.302 L 382.742 41.946 L 218.712 41.946 L 218.712 53.426 L 387.007 53.426 L 387.007 65.562 L 202.312 65.562 Z M 394.854 65.562 L 394.854 7.342 L 430.77 7.342 C 438.532 7.342 444.354 9.009 448.236 12.344 C 452.172 15.624 454.14 20.407 454.14 26.694 C 454.14 31.231 453.046 35.003 450.86 38.01 C 448.728 41.017 445.612 43.258 441.512 44.734 L 454.714 65.562 L 436.018 65.562 L 424.702 46.866 L 411.254 46.866 L 411.254 65.562 L 394.854 65.562 Z M 429.294 19.478 L 411.254 19.478 L 411.254 35.14 L 429.294 35.14 C 434.924 35.14 437.74 32.653 437.74 27.678 L 437.74 26.858 C 437.74 21.938 434.924 19.478 429.294 19.478 Z M 461.559 65.562 L 461.559 7.342 L 477.959 7.342 L 477.959 65.562 L 461.559 65.562 Z M 487.504 65.562 L 487.504 7.342 L 541.624 7.342 L 541.624 19.478 L 503.904 19.478 L 503.904 30.302 L 537.934 30.302 L 537.934 41.946 L 503.904 41.946 L 503.904 53.426 L 542.198 53.426 L 542.198 65.562 L 487.504 65.562 Z M 550.045 65.562 L 550.045 7.342 L 566.855 7.342 L 594.735 39.978 L 594.817 39.978 L 594.817 7.342 L 610.069 7.342 L 610.069 65.562 L 597.523 65.562 L 565.379 28.006 L 565.297 28.006 L 565.297 65.562 L 550.045 65.562 Z M 653.419 66.628 C 646.421 66.628 640.189 65.398 634.723 62.938 C 629.311 60.423 625.047 56.925 621.931 52.442 C 618.869 47.905 617.339 42.575 617.339 36.452 C 617.339 30.329 618.869 25.027 621.931 20.544 C 625.047 16.061 629.311 12.59 634.723 10.13 C 640.189 7.67 646.421 6.44 653.419 6.44 C 659.541 6.44 664.926 7.315 669.573 9.064 C 674.219 10.813 678.046 13.219 681.053 16.28 C 684.059 19.287 686.082 22.676 687.121 26.448 L 672.443 29.974 C 671.295 27.131 669.764 24.917 667.851 23.332 C 665.937 21.692 663.751 20.544 661.291 19.888 C 658.885 19.232 656.343 18.904 653.665 18.904 C 650.057 18.904 646.749 19.533 643.743 20.79 C 640.736 21.993 638.331 23.824 636.527 26.284 C 634.777 28.744 633.903 31.86 633.903 35.632 L 633.903 37.272 C 633.903 40.989 634.777 44.105 636.527 46.62 C 638.331 49.08 640.736 50.939 643.743 52.196 C 646.749 53.399 650.057 54 653.665 54 C 656.343 54 658.885 53.672 661.291 53.016 C 663.751 52.36 665.937 51.239 667.851 49.654 C 669.764 48.014 671.295 45.773 672.443 42.93 L 687.121 46.456 C 686.082 50.228 684.059 53.645 681.053 56.706 C 678.046 59.713 674.219 62.118 669.573 63.922 C 664.926 65.726 659.541 66.628 653.419 66.628 Z M 693.545 65.562 L 693.545 7.342 L 747.665 7.342 L 747.665 19.478 L 709.945 19.478 L 709.945 30.302 L 743.975 30.302 L 743.975 41.946 L 709.945 41.946 L 709.945 53.426 L 748.239 53.426 L 748.239 65.562 L 693.545 65.562 Z M 785.606 66.546 C 780.522 66.546 775.793 66.054 771.42 65.07 C 767.047 64.031 763.247 62.337 760.022 59.986 C 756.797 57.581 754.309 54.355 752.56 50.31 L 767.238 45.964 C 768.331 47.932 769.616 49.545 771.092 50.802 C 772.623 52.005 774.618 52.907 777.078 53.508 C 779.538 54.055 782.709 54.328 786.59 54.328 C 791.346 54.328 794.954 53.809 797.414 52.77 C 799.874 51.731 801.104 50.392 801.104 48.752 C 801.104 47.495 800.503 46.429 799.3 45.554 C 798.097 44.679 795.801 44.051 792.412 43.668 L 776.586 41.7 C 769.261 40.771 763.794 38.967 760.186 36.288 C 756.578 33.609 754.774 29.892 754.774 25.136 C 754.774 20.927 756.031 17.455 758.546 14.722 C 761.061 11.934 764.614 9.857 769.206 8.49 C 773.853 7.069 779.265 6.358 785.442 6.358 C 789.925 6.358 794.189 6.823 798.234 7.752 C 802.334 8.681 805.969 10.267 809.14 12.508 C 812.365 14.749 814.907 17.893 816.766 21.938 L 802.744 26.284 C 801.104 23.223 798.781 21.173 795.774 20.134 C 792.822 19.095 788.941 18.576 784.13 18.576 C 780.085 18.576 776.832 19.013 774.372 19.888 C 771.967 20.708 770.764 21.911 770.764 23.496 C 770.764 24.863 771.42 25.956 772.732 26.776 C 774.099 27.596 776.313 28.197 779.374 28.58 L 796.758 30.712 C 803.865 31.587 809.058 33.418 812.338 36.206 C 815.618 38.994 817.258 42.684 817.258 47.276 C 817.258 51.54 815.946 55.121 813.322 58.018 C 810.698 60.861 807.008 62.993 802.252 64.414 C 797.496 65.835 791.947 66.546 785.606 66.546 Z'
  };

  constructor() {
    this.navigationLoader.startLoading(3);
    this.updateSourceProgress(0, 100);
  }

  ngOnInit(): void {
    this.seoManager.updateTags({
      title: 'Kynsae - Creative Tech Studio',
      description: 'A multidisciplinary creative studio exploring creative tech in all forms. We bring ideas to life with web design, 3D renders, mobile development, and more.',
      keywords: 'web design, 3D rendering, mobile development, creative studio, UI/UX design, branding, motion design',
      type: 'website'
    });
  }
  
  ngAfterViewInit(): void {
    this.uiManager.resize(this.starSection().nativeElement.offsetTop);
  }

  public navigate(url: string) {
    this.router.navigateByUrl(url);
  }

  public updateSourceProgress(id: number, percentage: number): void {
    this.navigationLoader.updateSourceProgress(id, percentage);
  }

  @HostListener('window:resize')
  onResize() {
    this.uiManager.resize(this.starSection().nativeElement.offsetTop);
  }
}